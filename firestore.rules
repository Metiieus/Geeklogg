rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /* ------------------------------------------------------------------ *
     * üë§ PERFIS P√öBLICOS
     * ------------------------------------------------------------------ */
    match /users/{userId} {
      allow get, list : if request.auth != null;        // qualquer logado pode ver / listar perfis
      allow create    : if request.auth.uid == userId;  // cria o pr√≥prio perfil
      allow update,
            delete    : if request.auth.uid == userId;  // s√≥ o dono edita / remove
    }

    /* ------------------------------------------------------------------ *
     * SUBCOLE√á√ïES PRIVADAS DO USU√ÅRIO
     * (medias, reviews, milestones, achievements, etc.)
     * ------------------------------------------------------------------ */
    match /users/{userId}/{document=**} {
      allow read, write : if request.auth.uid == userId;   // somente o dono
    }

    /* ------------------------------------------------------------------ *
     * SEGUIDORES / SEGUINDO  ‚ûú leitura p√∫blica (apenas logado)
     * ------------------------------------------------------------------ */
    match /users/{userId}/followers/{docId} {
      allow read  : if request.auth != null;          // ‚úÖ qualquer logado pode ver
      allow write : if request.auth.uid == userId;    // grava√ß√£o s√≥ do dono
    }

    match /users/{userId}/following/{docId} {
      allow read  : if request.auth != null;          // ‚úÖ qualquer logado pode ver
      allow write : if request.auth.uid == userId;    // grava√ß√£o s√≥ do dono
    }

    /* ------------------------------------------------------------------ *
     * NOTIFICA√á√ïES PESSOAIS
     * ------------------------------------------------------------------ */
    match /users/{userId}/notifications/{docId} {
      allow read, write : if request.auth.uid == userId;
    }

    /* ------------------------------------------------------------------ *
     * FEED DE ATIVIDADES GLOBAL
     * ------------------------------------------------------------------ */
    match /activities/{docId} {
      allow read, create : if request.auth != null;   // todos logados podem ler/criar
      allow update, delete : if false;                // ningu√©m edita/deleta
    }

    /* ------------------------------------------------------------------ *
     * NOTIFICA√á√ïES GLOBAIS (an√∫ncios)
     * ------------------------------------------------------------------ */
    match /notifications/{docId} {
      allow read : if request.auth != null;
      allow write : if false;
    }

    /* ------------------------------------------------------------------ *
     * SOLICITA√á√ïES DE AMIZADE / SEGUIR
     * ------------------------------------------------------------------ */
    match /followRequests/{docId} {
      allow read, write : if request.auth != null;
    }
  }
}
